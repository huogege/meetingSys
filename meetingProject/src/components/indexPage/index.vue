<template>
  <div class="index">
        <div class="top">
            <div class="message">
                <div class="nameDepart"><span>姓名:</span><span style="margin-left:20px">{{meetingUser.name}}</span><span style="margin-left:50px">部门:</span><span style="margin-left:20px">{{meetingUser.dept}}</span></div>
                <div class="number"><span>电话号码:</span><span style="margin-left:20px">{{meetingUser.phone}}</span></div>
            </div>
            <div class="newMessage oneRowHide"> 
                    <router-link :to="{ path: 'inform', query: { name : meetingUser.name,phone:meetingUser.phone,dept:meetingUser.dept }}" class="router_link">
                        新消息：{{oneMessage}}
                    </router-link>
            </div>

         <div class="meetingStatus">
                <div class="list" v-for="item in inList">
                    <router-link  :to="{ path: 'meetingDetail', query: { mid : item.id }}" class="router_link">
                        <div class="status">
                            <span class="word">会议进行中</span>
                            <span class="time">已进行:{{formatMsgTime(item.stime,nowTime)}}</span>
                        </div>        
                        <div class="content">
                            <div class="left">
                                <h1 class="title oneRowHide">{{item.title}}</h1>
                                <p class="time oneRowHide"><span class="icon_4">&#8195;</span><span>开始时间:</span>{{formatTime(item.stime,'yyyy-MM-dd  hh:mm')}}</p>
                                <p class="location "><span class="icon_2">&#8195;</span><span>会议地点:</span>{{item.addr}}</p>
                            </div>
                        </div>
                     </router-link>
                     <div class="right">
                        <span class="icon"></span>
                        <span class="word">扫码签到</span>
                    </div>
            </div>
                <div class="list" v-for="item in soonList">
                    <router-link   :to="{ path: 'meetingDetail', query: { mid : item.id }}" class="router_link">
                        <div class="status">
                            <span class="word" style="background-color:#f1a54d">会议即将进行</span>
                        </div>        
                        <div class="content">
                            <div class="left">
                                <h1 class="title oneRowHide">{{item.title}}</h1>
                                <p class="time oneRowHide"><span class="icon_4">&#8195;</span><span>开始时间:</span>{{formatTime(item.stime,'yyyy-MM-dd  hh:mm')}}</p>
                                <p class="location "><span class="icon_2">&#8195;</span><span>会议地点:</span>{{item.addr}}</p>
                            </div>
                        </div>
                     </router-link>    
                    <div class="right">
                        <span class="icon"></span>
                        <span class="word">扫码签到</span>
                    </div>
                </div>
           
             <div class="list" v-for="(item,index) in changeList" :class="index == changeList.length-1? 'marginNone':''">
                        <div class="joinStatus" v-show="item.cj_status == 1 && item.qr_type == 2">
                            <span class="findOthers" @click.stop.self="findOthers()">找人开会</span>
                            <span class="refuse" @click.stop.self="refuse()">不参与</span>
                        </div>
                        <div class="joinStatus" v-show="item.cj_status == 2 && item.qr_type == 2">
                            <span class="findOthers">已确认参会</span>
                            <span class="refuse" @click.stop.self="refuse()">不参与</span>
                        </div>
                        <div class="joinStatus" v-show="item.cj_status == 3 && item.qr_type == 2">
                            <span class="refuse">暂不参与不参与</span>
                        </div>
                        <div class="joinStatus" v-show="item.cj_status == 4 && item.qr_type == 2">
                            <span class="findOthers">已找人开会</span>
                            <span class="refuse">不参与</span>
                        </div>

                    <router-link :to="{ path: 'meetingDetail', query: { mid : item.id }}" class="router_link">  
                    <div class="status2">
                        
                        <h1 class="title oneRowHide">{{item.title}}</h1>
                    
                    </div>      
                    <div class="content">
                        <div class="left" style="padding-right:50px;;">
                            <p class="from"><span class="icon_3">&#8195;</span><span>发起单位</span>{{item.unit}}</p>
                            <p class="time oneRowHide"><span class="icon_4">&#8195;</span><span>开始时间:</span>{{formatTime(item.stime,'yyyy-MM-dd  hh:mm')}}</p>
                            <p class="location over_text_2"><span class="icon_2">&#8195;</span><span>会议地点</span>{{item.addr}}</p>
                        </div>
                    </div>
                </router-link>
            </div>  
            <router-link  :to="{ path: 'meetingList'}"class="router_link">
                <div class="moreMeeting">更多会议</div>   
            </router-link>   
        </div>
    </div>
</div>
</template>
<script>
    import fn from "../../common/js/index.js";
    var phone = fn.phone;
    export default{
        components:{
         
        },
        data:function(){
            return{     
                URL1:'http://www.zaichongqing.com/jj_project/wapMeeting/manager/doMeeting' ,  //进行会议或即将进行会议
                URLS:'http://www.zaichongqing.com/jj_project/wapMeeting/manager/meetingAll',
                URL2:'http://www.zaichongqing.com/jj_project/wapMeeting/manager/meetingAll',//全部会议
                URL3:'http://www.zaichongqing.com/jj_project/wapMeeting/manager/notStartMeeting',// 未开始会议
                URL4:'http://www.zaichongqing.com/jj_project/wapMeeting/manager/endMeeting',     //已结束会议   
                URL5: 'http://www.zaichongqing.com/jj_project/wapMeeting/manager/msgList'  ,     //消息 
               meetingUser:'' ,
                currentItem:0,
               pullup:true,
               listenScroll:true,  
               meetingUser:'' ,
               inList:[],
               soonList:[], 
               changeList:[],
               oneMessage:'',
               nowTime:'',    
               page:1,
               num:5

            }
        },
        methods:{
            formatTime:fn.format,
            formatMsgTime:fn.formatMsgTime,
            request1:function(url,params){
                 var _this = this;
                _this.$http.get(url, {
                    params: params
                    })
                    .then(function (response) {
                        if(response.status == "200" && response.data.rtnCode == "0000"){
                            if(response.data.data!=''){
                                 _this.meetingUser = response.data.data.meetingUser;
                                 _this.inList =  response.data.data.list;
                                _this.soonList =  response.data.data.soonlist;
                                 _this.nowTime =  response.data.data.params.nowtime;
                                 
                                                    
                            }
                        }
                    })
            },
            request2:function(url,params){
                 var _this = this;
                _this.$http.get(url, {
                    params: params
                    })
                    .then(function (response) {
                        if(response.status == "200" && response.data.rtnCode == "0000"){
                            if(response.data.data!=''){
                                var thisData = response.data.data.list.list;
                                _this.changeList = thisData
                                  
                            }
                        }
                    })
            },
            getMessage:function(){
                var _this = this;
                _this.$http.get(this.URL5, {
                    params: {phone:phone,num:1}
                    })
                    .then(function (response) {
                        if(response.status == "200" && response.data.rtnCode == "0000"){
                            if(response.data.data!=''){
                                _this.oneMessage = response.data.data.list[0].content;
                            }
                        }
                    })
            },
            findOthers:function(){
                alert("gg")
                return false;
            }
           
        }, 
        created:function(){
        
            this.request1(this.URL1,{phone:phone,num:1000});
             this.request2(this.URLS,{phone:phone,num:this.num});    
            this.getMessage();
       
           
        },
        mounted:function(){   
         
           
        }
        

    }
</script>


<style lang="less" rel="stylesheet/less" scoped>
@import "../../common/css/common.less";

.index {
    .img_box{
        width: 7.5rem;
        height: 4rem;
    }
    .message {
        font-size: .3rem;
        color: #fff;
        height: 1rem;
        padding: .25rem .5rem;
        background-image: url("./bmg_1.png");
        background-position: center;
        background-repeat: no-repeat;
        background-size:100%;
        .nameDepart {
            margin-bottom: .2rem;
        }
    }
    .newMessage {
        height: .7rem;
        line-height: .7rem;
        color: #575757;
        font-size: .24rem;
        background-image: url("./icon_5.png");
        background-repeat: no-repeat;
        background-position: .25rem;
        background-size:.3rem .3rem;
        text-indent: .7rem;
        background-color: #f3f3f3;
        .a_link{
            display: grid;
            text-align: center;
        }
    }
    .meetingStatus {
        background-color: #f1f1f1;
        .moreMeeting{
            font-size: .32rem;
            line-height: .8rem;
            text-align: center;
            background-image: url("./bottom.png");
            background-repeat: no-repeat;
            background-position: 37%;
            background-size:.4rem .4rem;
        }
    }
    
    .marginNone{
        margin: 0!important;
    }

    .list {
            background-color: #fff;
            margin-bottom: .3rem;
            width: 7.5rem;
            position: relative;
            .status {
                height: .5rem;
                .word {
                    float: left;
                    display: inline-block;
                    padding: .1rem .4rem .1rem .2rem;
                    border-radius: 0 .2rem .2rem 0;
                    color: #fff;
                    background-color: #57cb4e;
                    font-size: .26rem;
                }
                .time {
                    line-height: .5rem;
                    font-size: .26rem;
                    color: #666;
                    float: right;
                    vertical-align: middle;
                    margin-right: .2rem;
                }
            }
            .joinStatus{
                    font-size: .24rem;
                    float: right;
                    margin: .35rem .2rem 0 
                }
                .refuse{
                    display: inline-block;
                    padding: .05rem .1rem;
                    border: 1px solid #ff7e30;
                    border-radius: 5px;
                    color: #ff7e30;
                    margin-left: .1rem;
                }
                .findOthers{
                    display: inline-block;
                    padding: .05rem .1rem;
                    border: 1px solid #178aff;
                    border-radius: 5px;
                    color: #178aff;
                }
            .status2{
                display: flex;
                padding: .35rem .1rem 0 .35rem;
                .title {
                    width: 60%;
                    font-size: .34rem;
                    width: 5.3rem;
                    font-weight: 500;
                }
            }
        }
        .content {
            display: flex;
            width: 100%;
            .left {
                    flex: 3;
                    width: 75%;
                    padding: .35rem 0 .35rem .35rem;
                .title{
                    font-size: .34rem;
                    width: 5.3rem;
                    font-weight: 500;
                    margin-bottom: .4rem;
                }
                .icon_2 {
                    background-image: url("./icon_2.png");
                    background-repeat: no-repeat;
                    background-position: center;
                     background-size:.23rem .28rem;
                    margin-right: .2rem;
                }
                .icon_3 {
                    background-image: url("./icon_3.png");
                    background-repeat: no-repeat;
                    background-position: center;
                     background-size:.24rem .24rem;
                    margin-right: .2rem;
                }
                .icon_4 {
                    background-image: url("./icon_4.png");
                    background-repeat: no-repeat;
                    background-position: center;
                     background-size:.24rem .24rem;
                    margin-right: .2rem;
                }
                p{
                    font-size: .24rem;
                    margin-bottom: .2rem;
                    line-height: .35rem;
                    &:last-child{
                        margin-bottom: 0;
                    }
                }
            }
            
        }
        .right {
                position: absolute;
                top: .5rem;
                right: 0;
                flex: 1;
                width: 25%;
                display: flex;
                flex-direction: column;
                padding-top: .2rem;
                text-align: center;
               
                .icon {
                    display: inline-block;
                    width: 1rem;
                    height: 1rem;
                    background-image: url("./icon_1.png");
                    background-repeat: no-repeat;
                    background-position: center;
                    background-size:.85rem .72rem;
                    margin: 0 auto;
                }
                .word {
                    font-size: .24rem;
                    margin-top: .2rem;
                    color: #178aff;
                }
            }
        .menu{
               display:flex;
               border-bottom:1px solid #e5e5e5;
               .submenu{
                    flex:1;
                    height:.9rem;
                    line-height:.9rem;
                    text-align:center;
                    font-size:.28rem;
                    color:#666;
                    background-color: #fff;
               }
               .active{
                   border-bottom:5px solid #2d95ff;
                   color:#2d95ff;
               }
        }
    .meetingType{
         background-color: #f1f1f1;
        
        .menu_content{
            .wrapper{
                position: absolute;
                top: 5rem;
                bottom: -5rem;
                left: 0;
                overflow: hidden;
            }
        }
       
    }
}
</style>


